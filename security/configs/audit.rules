# SecurityForge Linux - Configuração Ultra-Completa de Auditoria

# Buffer para eventos (aumentado para alta atividade)
-b 16384

# Rate limiting (events per second)
-r 2000

# Falhas são críticas (system halt on failure)
-f 2

# Deletar regras existentes
-D

# ============================================================================
# MONITORAMENTO DE ARQUIVOS CRÍTICOS DO SISTEMA
# ============================================================================

# Arquivos de autenticação e autorização
-w /etc/passwd -p wa -k passwd_changes
-w /etc/group -p wa -k group_changes
-w /etc/shadow -p wa -k shadow_changes
-w /etc/gshadow -p wa -k gshadow_changes
-w /etc/sudoers -p wa -k sudoers_changes
-w /etc/sudoers.d/ -p wa -k sudoers_changes

# Configurações de SSH
-w /etc/ssh/sshd_config -p wa -k ssh_config_changes
-w /etc/ssh/ -p wa -k ssh_changes

# Configurações de rede
-w /etc/network/ -p wa -k network_changes
-w /etc/systemd/network/ -p wa -k network_changes
-w /etc/netplan/ -p wa -k network_changes
-w /etc/hosts -p wa -k network_changes
-w /etc/hostname -p wa -k network_changes
-w /etc/resolv.conf -p wa -k network_changes

# Configurações de firewall
-w /etc/ufw/ -p wa -k firewall_changes
-w /etc/fail2ban/ -p wa -k firewall_changes
-w /etc/iptables/ -p wa -k firewall_changes

# Configurações de segurança
-w /etc/security/ -p wa -k security_changes
-w /etc/apparmor.d/ -p wa -k apparmor_changes
-w /etc/selinux/ -p wa -k selinux_changes

# Configurações de sistema
-w /etc/sysctl.conf -p wa -k sysctl_changes
-w /etc/sysctl.d/ -p wa -k sysctl_changes

# Logs do sistema
-w /var/log/ -p wa -k log_access
-w /var/log/securityforge/ -p wa -k securityforge_logs

# Ferramentas do SecurityForge
-w /opt/securityforge/ -p wa -k securityforge_tools

# Binários críticos
-w /bin/ -p wa -k system_binaries
-w /sbin/ -p wa -k system_binaries
-w /usr/bin/ -p wa -k system_binaries
-w /usr/sbin/ -p wa -k system_binaries
-w /usr/local/bin/ -p wa -k system_binaries

# Bibliotecas críticas
-w /lib/ -p wa -k system_libraries
-w /lib64/ -p wa -k system_libraries
-w /usr/lib/ -p wa -k system_libraries
-w /usr/lib64/ -p wa -k system_libraries

# ============================================================================
# MONITORAMENTO DE CHAMADAS DE SISTEMA PRIVILEGIADAS
# ============================================================================

# Mudanças de tempo do sistema
-a always,exit -F arch=b64 -S adjtimex -S settimeofday -k time_change
-a always,exit -F arch=b32 -S adjtimex -S settimeofday -S stime -k time_change
-a always,exit -F arch=b64 -S clock_settime -k time_change
-a always,exit -F arch=b32 -S clock_settime -k time_change
-w /etc/localtime -p wa -k time_change

# Mudanças de identidade e privilégios
-a always,exit -F arch=b64 -S setuid -S setgid -S setreuid -S setregid -k identity
-a always,exit -F arch=b32 -S setuid -S setgid -S setreuid -S setregid -k identity
-a always,exit -F arch=b64 -S setresuid -S setresgid -k identity
-a always,exit -F arch=b32 -S setresuid -S setresgid -k identity

# Operações de arquivos privilegiadas
-a always,exit -F arch=b64 -S chmod -S fchmod -S fchmodat -k perm_mod
-a always,exit -F arch=b32 -S chmod -S fchmod -S fchmodat -k perm_mod
-a always,exit -F arch=b64 -S chown -S fchown -S fchownat -S lchown -k perm_mod
-a always,exit -F arch=b32 -S chown -S fchown -S fchownat -S lchown -k perm_mod

# Acesso a arquivos sensíveis
-a always,exit -F arch=b64 -S open -S openat -S creat -S truncate -S ftruncate -k file_access
-a always,exit -F arch=b32 -S open -S openat -S creat -S truncate -S ftruncate -k file_access

# Montagem de sistemas de arquivos
-a always,exit -F arch=b64 -S mount -k mounts
-a always,exit -F arch=b32 -S mount -k mounts
-a always,exit -F arch=b64 -S umount2 -k mounts
-a always,exit -F arch=b32 -S umount -S umount2 -k mounts

# Exclusão de arquivos
-a always,exit -F arch=b64 -S unlink -S unlinkat -S rename -S renameat -k delete
-a always,exit -F arch=b32 -S unlink -S unlinkat -S rename -S renameat -k delete

# Carregamento de módulos do kernel
-a always,exit -F arch=b64 -S init_module -S delete_module -k modules
-a always,exit -F arch=b32 -S init_module -S delete_module -k modules
-a always,exit -F arch=b64 -S finit_module -k modules

# ============================================================================
# MONITORAMENTO DE REDE
# ============================================================================

# Criação de sockets
-a always,exit -F arch=b64 -S socket -k network_socket
-a always,exit -F arch=b32 -S socketcall -k network_socket

# Bind de portas privilegiadas
-a always,exit -F arch=b64 -S bind -k network_bind
-a always,exit -F arch=b32 -S bind -k network_bind

# Conexões de rede
-a always,exit -F arch=b64 -S connect -k network_connect
-a always,exit -F arch=b32 -S connect -k network_connect

# ============================================================================
# MONITORAMENTO DE PROCESSOS
# ============================================================================

# Execução de programas
-a always,exit -F arch=b64 -S execve -k exec
-a always,exit -F arch=b32 -S execve -k exec

# Criação de processos
-a always,exit -F arch=b64 -S clone -k process_creation
-a always,exit -F arch=b32 -S clone -k process_creation
-a always,exit -F arch=b64 -S fork -S vfork -k process_creation
-a always,exit -F arch=b32 -S fork -S vfork -k process_creation

# Terminação de processos
-a always,exit -F arch=b64 -S kill -k process_termination
-a always,exit -F arch=b32 -S kill -k process_termination

# ============================================================================
# MONITORAMENTO ESPECÍFICO PARA FERRAMENTAS DE SEGURANÇA
# ============================================================================

# Execução de ferramentas de pentest
-w /usr/bin/nmap -p x -k pentest_tools
-w /usr/bin/nikto -p x -k pentest_tools
-w /usr/bin/sqlmap -p x -k pentest_tools
-w /usr/bin/hydra -p x -k pentest_tools
-w /usr/bin/john -p x -k pentest_tools
-w /usr/bin/hashcat -p x -k pentest_tools
-w /usr/bin/aircrack-ng -p x -k pentest_tools
-w /usr/bin/wireshark -p x -k pentest_tools
-w /usr/bin/msfconsole -p x -k pentest_tools

# Acesso a wordlists e exploits
-w /opt/securityforge/wordlists/ -p ra -k wordlist_access
-w /opt/securityforge/exploits/ -p ra -k exploit_access
-w /opt/securityforge/payloads/ -p ra -k payload_access

# ============================================================================
# FINALIZAR CONFIGURAÇÃO
# ============================================================================

# Tornar a configuração imutável
-e 2
